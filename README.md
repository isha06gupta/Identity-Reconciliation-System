# BiteSpeed Identity Reconciliation (Spring Boot)

A complete Spring Boot backend for BiteSpeed's identity reconciliation assignment.

## Tech stack
- Java 17
- Spring Boot
- Spring Data JPA
- PostgreSQL
- Maven

## Project structure
```text
src/main/java/com/bitespeed/identity_reconciliation/
  controller/
  service/
  repository/
  entity/
  dto/
```

## API
### POST `/identify`
Request:
```json
{
  "email": "doc@fluxkart.com",
  "phoneNumber": "999999"
}
```

Response:
```json
{
  "contact": {
    "primaryContactId": 1,
    "emails": ["doc@fluxkart.com", "george@hillvalley.edu"],
    "phoneNumbers": ["999999", "123456"],
    "secondaryContactIds": [2, 3]
  }
}
```

### Sample cURL
```bash
curl --location 'http://localhost:8080/identify' \
--header 'Content-Type: application/json' \
--data '{
  "email": "doc@fluxkart.com",
  "phoneNumber": "999999"
}'
```

## Local run instructions
1. Start PostgreSQL and create a database named `identity_reconciliation`.
2. Configure environment variables (or edit `application.properties`):
   - `SPRING_DATASOURCE_URL`
   - `SPRING_DATASOURCE_USERNAME`
   - `SPRING_DATASOURCE_PASSWORD`
3. Run the application:
   ```bash
   ./mvnw spring-boot:run
   ```
4. Test endpoint using the sample cURL.

## Render deployment instructions
1. Push this project to GitHub.
2. On Render, create:
   - a **PostgreSQL** instance
   - a **Web Service** (Java)
3. Configure Web Service:
   - Build command: `./mvnw clean package`
   - Start command: `java -jar target/identity-reconciliation-0.0.1-SNAPSHOT.jar`
4. Add environment variables in Render service:
   - `SPRING_DATASOURCE_URL` (Render PostgreSQL internal URL)
   - `SPRING_DATASOURCE_USERNAME`
   - `SPRING_DATASOURCE_PASSWORD`
   - `PORT` (Render usually injects this automatically)
5. Deploy and test:
   ```bash
   curl --location 'https://<your-render-service>.onrender.com/identify' \
   --header 'Content-Type: application/json' \
   --data '{"email":"doc@fluxkart.com","phoneNumber":"999999"}'
   ```

## Notes
- Supports null email or null phoneNumber (but not both null).
- Reconciliation is transactional.
- Oldest contact in a linked group is enforced as PRIMARY.
- New information creates a SECONDARY contact linked to PRIMARY.
- Table is auto-generated by Hibernate (`spring.jpa.hibernate.ddl-auto=update`).
